<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Students_overview extends CI_Controller {

    function __construct()
    {
        parent::__construct();

        $this->load->model('Users_model','',TRUE);
        $this->Users_model->loginCheck();

        $this->load->model('UsersManager_model','',TRUE);
        $this->load->model('Submit_model','',TRUE);
    }

	function index()
	{
		// GET
		$school_year = $this->input->get('school_year');

		$class = $this->input->get('classe');

		// get students
		if($class)
		{
			$students_list = $this->Users_model->getAllUsersByClass('student', $class, TRUE);
		}
		else
		{
			$students_list = $this->Users_model->getAllUsers();
		}
		// get averages and achievements
		$this->load->model('Achievements_model','',TRUE);
		foreach ($students_list as $key => $student)
		{
			$students_list[$key]->results = $this->Results_model->getUserVoteAverageByTermAndSchoolYear($student->id, FALSE, $school_year);
			$students_list[$key]->achievements = $this->Achievements_model->getAllAchievementsByStudent($student->id);
		}
//dump($students_list);
		$this->data['students'] = $students_list;
		$this->load->template('admin/students_overview', $this->data);
	}
}
?>
